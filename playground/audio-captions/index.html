<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="styles.css" type="text/css" rel="stylesheet">
<title>Audio captions example</title>

<base href="https://torgeilo.github.io/playground/audio-captions/">

<header>
  <h1>Audio captions example</h1>
  <p>...with highlighting. Using the HTML5 audio and track elements, and a WebVTT file containing timed text. No libraries.</p>
  <p>Audio recording from <a href="http://librivox.org">LibriVox</a>. Captions from <a href="http://www.guteberg.org">Project Gutenberg</a>.</p>
</header>

<section id="media">
  <h1>The Hare and the Tortoise</h1>

  <audio src="data/02_haretortoise_aesop_bt.mp3" controls crossorigin="*">
   <track src="data/the_hare_and_the_tortoise.vtt" kind="captions" srclang="en" label="English" default>
  </audio>

  <div class="captions"></div>
</section>

<script>
(function() {
  var media = document.getElementById("media");
  var track = media.querySelector("track");
  var captions = media.querySelector(".captions");

  function formatTime(seconds) {
    var m = Math.floor(seconds / 60);
    var s = Math.round(seconds % 60);
    return (m < 10 ? "0" : "") + m + ":" + (s < 10 ? "0" : "") + s;
  }

  function renderCue(cue) {
    var paragraph = document.createElement("p");
    var indicator = document.createElement("span");
    indicator.appendChild(document.createTextNode(formatTime(cue.startTime)));
    paragraph.appendChild(indicator);
    paragraph.appendChild(document.createTextNode(cue.text));
    captions.appendChild(paragraph);
    return paragraph;
  }

  track.addEventListener("load", function() {
    var textTrack = track.track;

    Array.prototype.forEach.call(textTrack.cues, function(cue) {
      var cueEl = renderCue(cue);
      cue.addEventListener("enter", function() {
          cueEl.classList.add("current");
      });
      cue.addEventListener("exit", function() {
          cueEl.classList.remove("current");
      });
    });
  });
})();
</script>
